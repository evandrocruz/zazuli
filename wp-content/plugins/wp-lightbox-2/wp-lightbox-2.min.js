(function(a){a.fn.lightbox=function(k){var u=a.extend({},a.fn.lightbox.defaults,k);function p(){e();o(this);return false}if(parseFloat(a().jquery)>=1.7){return a(this).on("click",p)}else{return a(this).live("click",p)}function e(){a(window).bind("orientationchange",q);a(window).bind("resize",q);a("#overlay").remove();a("#lightbox").remove();u.isIE8=v();u.inprogress=false;if(u.jsonData&&u.jsonData.length>0){var C=u.jsonDataParser?u.jsonDataParser:a.fn.lightbox.parseJsonData;u.imageArray=[];u.imageArray=C(u.jsonData)}var z='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe" /><img id="lightboxImage"><div id="hoverNav"><a href="javascript://" title="'+u.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+u.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><div id="jqlb_loading"></div></a></div></div></div>';var B='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav">';if(u.displayHelp){B+='<span id="helpDisplay">'+u.strings.help+"</span>"}B+='<a href="javascript://" id="bottomNavClose" title="'+u.strings.closeTitle+'"><div id="jqlb_closelabel"></div></a></div></div></div>';var A;if(u.navbarOnTop){A='<div id="overlay"></div><div id="lightbox">'+B+z+"</div>";a("body").append(A);a("#imageDataContainer").addClass("ontop")}else{A='<div id="overlay"></div><div id="lightbox">'+z+B+"</div>";a("body").append(A)}a("#overlay").click(function(){h()}).hide();a("#lightbox").click(function(){h()}).hide();a("#loadingLink").click(function(){h();return false});a("#bottomNavClose").click(function(){h();return false});a("#outerImageContainer").width(u.widthCurrent).height(u.heightCurrent);a("#imageDataContainer").width(u.widthCurrent);if(!u.imageClickClose){a("#lightboxImage").click(function(){return false});a("#hoverNav").click(function(){return false})}}function q(z){if(u.resizeTimeout){clearTimeout(u.resizeTimeout);u.resizeTimeout=false}u.resizeTimeout=setTimeout(function(){y(false)},50)}function x(){var A=a(document).height();if(u.isIE8&&A>4096){A=4096}var z=a(window).height()-u.adminBarHeight;return new Array(a(document).width(),A,a(window).width(),z,a(document).height())}function v(){var A=false;if(document.createElement){var z=document.createElement("div");if(z&&z.querySelectorAll){z.innerHTML='<object><param name=""></object>';A=z.querySelectorAll("param").length!=1}z=null}return A}function g(){var A=0;var z=0;if(self.pageYOffset){z=self.pageYOffset;A=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){z=document.documentElement.scrollTop;A=document.documentElement.scrollLeft}else{if(document.body){z=document.body.scrollTop;A=document.body.scrollLeft}}}if(u.adminBarHeight&&parseInt(a("#wpadminbar").css("top"),10)===0){z+=u.adminBarHeight}return new Array(A,z)}function o(D){a("select, embed, object").hide();var B=x();var z=g();var A=0;a("#overlay").hide().css({width:B[0]+"px",height:B[1]+"px",opacity:u.overlayOpacity}).fadeIn(400);if(u.isIE8&&B[1]==4096){if(z[1]>=1000){A=z[1]-1000;if((B[4]-(z[1]+3096))<0){A-=(z[1]+3096)-B[4]}a("#overlay").css({top:A+"px"})}}imageNum=0;if(!u.jsonData){u.imageArray=[];if(!D.rel||(D.rel=="")){var C="";if(D.title){C=D.title}else{if(a(this).children(":first-child").attr("title")){C=a(this).children(":first-child").attr("title")}}u.imageArray.push(new Array(D.href,u.displayTitle?C:""))}else{a("a").each(function(){if(this.href&&(this.rel==D.rel)){var H="";var F="";var J="";var E=a(this);if(this.title){H=this.title}else{if(E.children("img:first-child").attr("title")){H=E.children("img:first-child").attr("title")}}if(E.parent().next(".gallery-caption").html()){var I=E.parent().next(".gallery-caption");F=I.html();J=I.text()}else{if(E.next(".wp-caption-text").html()){F=E.next(".wp-caption-text").html();J=E.next(".wp-caption-text").text()}}H=a.trim(H);J=a.trim(J);if(H.toLowerCase()==J.toLowerCase()){H=F;F=""}var G="";if(H!=""){G='<span id="titleText">'+H+"</span>"}if(F!=""){if(H!=""){G+="<br />"}G+='<span id="captionText">'+F+"</span>"}u.imageArray.push(new Array(this.href,u.displayTitle?G:""))}})}}if(u.imageArray.length>1){for(i=0;i<u.imageArray.length;i++){for(j=u.imageArray.length-1;j>i;j--){if(u.imageArray[i][0]==u.imageArray[j][0]){u.imageArray.splice(j,1)}}}while(u.imageArray[imageNum][0]!=D.href){imageNum++}}m(z[1],z[0]).show();w(imageNum)}function m(z,A){if(u.resizeSpeed>0){a("#lightbox").animate({top:z},250,"linear");return a("#lightbox").animate({left:A},250,"linear")}return a("#lightbox").css({top:z+"px",left:A+"px"})}function w(z){if(u.inprogress==false){u.inprogress=true;u.activeImage=z;a("#loading").show();a("#lightboxImage").hide();a("#hoverNav").hide();a("#prevLink").hide();a("#nextLink").hide();l()}}function l(){u.imgPreloader=new Image();u.imgPreloader.onload=function(){a("#lightboxImage").attr("src",u.imageArray[u.activeImage][0]);y();f()};u.imgPreloader.src=u.imageArray[u.activeImage][0]}function y(){if(!u.imgPreloader){return}var C=u.imgPreloader.width;var z=u.imgPreloader.height;var E=x();var K=(E[2]<E[0])?E[0]:E[2];a("#overlay").css({width:K+"px",height:E[1]+"px"});var I=(E[3])-(a("#imageDataContainer").height()+(2*u.borderSize));var J=(E[2])-(2*u.borderSize);if(u.fitToScreen){var A=I-u.marginSize;var L=J-u.marginSize;var F=1;if(z>A){F=A/z}C=C*F;z=z*F;F=1;if(C>L){F=L/C}C=Math.round(C*F);z=Math.round(z*F)}var D=g();var B=D[1]+(I*0.5);var G=B-z*0.5;var H=D[0];a("#lightboxImage").width(C).height(z);n(C,z,G,H)}function n(C,A,E,D){u.widthCurrent=a("#outerImageContainer").outerWidth();u.heightCurrent=a("#outerImageContainer").outerHeight();var z=Math.max(350,C+(u.borderSize*2));var B=(A+(u.borderSize*2));u.xScale=(z/u.widthCurrent)*100;u.yScale=(B/u.heightCurrent)*100;m(E,D);c();a("#imageDataContainer").animate({width:z},u.resizeSpeed,"linear");a("#outerImageContainer").animate({width:z},u.resizeSpeed,"linear",function(){a("#outerImageContainer").animate({height:B},u.resizeSpeed,"linear",function(){d()})});s();a("#prevLink").height(A);a("#nextLink").height(A)}function d(){a("#imageData").show();a("#caption").show();a("#loading").hide();if(u.resizeSpeed>0){a("#lightboxImage").fadeIn("fast")}else{a("#lightboxImage").show()}u.inprogress=false}function f(){if(u.loopImages&&u.imageArray.length>1){preloadNextImage=new Image();preloadNextImage.src=u.imageArray[(u.activeImage==(u.imageArray.length-1))?0:u.activeImage+1][0];preloadPrevImage=new Image();preloadPrevImage.src=u.imageArray[(u.activeImage==0)?(u.imageArray.length-1):u.activeImage-1][0]}else{if((u.imageArray.length-1)>u.activeImage){preloadNextImage=new Image();preloadNextImage.src=u.imageArray[u.activeImage+1][0]}if(u.activeImage>0){preloadPrevImage=new Image();preloadPrevImage.src=u.imageArray[u.activeImage-1][0]}}}function c(){a("#numberDisplay").html("");a("#caption").html("").hide();if(u.imageArray[u.activeImage][1]){a("#caption").html(u.imageArray[u.activeImage][1]).show()}var C="";var B="";var D=(u.imageArray.length>1)?u.strings.image+(u.activeImage+1)+u.strings.of+u.imageArray.length:"";var A=(u.displayDownloadLink)?'<a href="'+u.imageArray[u.activeImage][0]+'" id="downloadLink" target="'+u.linkTarget+'">'+u.strings.download+"</a>":"";var z="";if(u.imageArray.length>1&&!u.disableNavbarLinks){if((u.activeImage)>0||u.loopImages){B='<a title="'+u.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+u.strings.prevLinkText+"</a>"}if(((u.activeImage+1)<u.imageArray.length)||u.loopImages){z+='<a title="'+u.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+u.strings.nextLinkText+"</a>"}}C=B+C+D+A+z;if(C!=""){a("#numberDisplay").html(C).show()}}function s(){if(u.imageArray.length>1){a("#hoverNav").show();if(u.loopImages){a("#prevLink,#prevLinkText").show().click(function(){w((u.activeImage==0)?(u.imageArray.length-1):u.activeImage-1);return false});a("#nextLink,#nextLinkText").show().click(function(){w((u.activeImage==(u.imageArray.length-1))?0:u.activeImage+1);return false})}else{if(u.activeImage!=0){a("#prevLink,#prevLinkText").show().click(function(){w(u.activeImage-1);return false})}if(u.activeImage!=(u.imageArray.length-1)){a("#nextLink,#nextLinkText").show().click(function(){w(u.activeImage+1);return false})}}b()}}function h(){r();a("#lightbox").hide();a("#overlay").fadeOut();a("select, object, embed").show()}function t(C){var D=C.data.opts;var z=C.keyCode;var A=27;var B=String.fromCharCode(z).toLowerCase();if((B=="x")||(B=="o")||(B=="c")||(z==A)){h()}else{if((B=="p")||(z==37)){if(D.loopImages){r();w((D.activeImage==0)?(D.imageArray.length-1):D.activeImage-1)}else{if(D.activeImage!=0){r();w(D.activeImage-1)}}}else{if((B=="n")||(z==39)){if(u.loopImages){r();w((D.activeImage==(D.imageArray.length-1))?0:D.activeImage+1)}else{if(D.activeImage!=(D.imageArray.length-1)){r();w(D.activeImage+1)}}}}}return false}function b(){a(document).bind("keydown",{opts:u},t)}function r(){a(document).unbind("keydown")}};a.fn.lightbox.parseJsonData=function(c){var b=[];a.each(c,function(){b.push(new Array(this.url,this.title))});return b};a.fn.lightbox.defaults={adminBarHeight:28,overlayOpacity:0.8,borderSize:10,imageArray:new Array,activeImage:null,inprogress:false,widthCurrent:250,heightCurrent:250,xScale:1,yScale:1,displayTitle:true,disableNavbarLinks:true,loopImages:true,imageClickClose:true,jsonData:null,jsonDataParser:null,followScroll:false,isIE8:false};a(document).ready(function(d){var b=(typeof JQLBSettings=="object");if(b&&JQLBSettings.resizeSpeed){JQLBSettings.resizeSpeed=parseInt(JQLBSettings.resizeSpeed)}if(b&&JQLBSettings.marginSize){JQLBSettings.marginSize=parseInt(JQLBSettings.marginSize)}var c={help:" Browse images with your keyboard: Arrows or P(revious)/N(ext) and X/C/ESC for close.",prevLinkTitle:"previous image",nextLinkTitle:"next image",prevLinkText:"&laquo; Previous",nextLinkText:"Next &raquo;",closeTitle:"close image gallery",image:"Image ",of:" of ",download:"Download"};d('a[rel^="lightbox"]').lightbox({adminBarHeight:d("#wpadminbar").height()||0,linkTarget:(b&&JQLBSettings.linkTarget.length)?JQLBSettings.linkTarget:"_self",displayHelp:(b&&JQLBSettings.help.length)?true:false,marginSize:(b&&JQLBSettings.marginSize)?JQLBSettings.marginSize:0,fitToScreen:(b&&JQLBSettings.fitToScreen=="1")?true:false,resizeSpeed:(b&&JQLBSettings.resizeSpeed>=0)?JQLBSettings.resizeSpeed:400,displayDownloadLink:(b&&JQLBSettings.displayDownloadLink=="0")?false:true,navbarOnTop:(b&&JQLBSettings.navbarOnTop=="0")?false:true,strings:(b&&typeof JQLBSettings.help=="string")?JQLBSettings:c})})})(jQuery);